# GCP上のFastAPIアプリに自分のIPアドレスからのみ接続を許可する手順

## 1. 自分のグローバルIPアドレスを調べる
- Googleで「IPアドレス」と検索すると表示されます。
- 例: `123.45.67.89`

## 2. GCPのファイアウォールルールを設定
1. GCPコンソールにログイン
2. 左メニュー「VPCネットワーク」→「ファイアウォールルール」
3. 「ファイアウォールルールを作成」をクリック
4. 以下のように設定

| 項目                | 設定例                      |
|---------------------|-----------------------------|
| 名前                | allow-my-ip-8000            |
| ネットワーク        | default（通常はこれでOK）   |
| 優先度              | 1000（デフォルトでOK）      |
| ターゲット          | すべてのインスタンス        |
| ソースIP範囲        | あなたのIPアドレス/32       |
| プロトコルとポート  | tcp:8000                    |

- 例: ソースIP範囲に `123.45.67.89/32` と入力

## 3. FastAPIアプリのhostを0.0.0.0にする
main.pyの最後を以下のように修正します。
```python
if __name__=="__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=8000)
```

## 4. サーバーを起動
```sh
python3 main.py
```
## 5. 自分のPCからアクセス
- ブラウザで `http://[VMの外部IPアドレス]:8000` にアクセス

## 6. 別のノートパソコンで行う場合
- そのノートパソコンのグローバルIPアドレスを調べる
- GCPファイアウォールルールの「ソースIP範囲」にそのIPアドレス/32を追加する（または新規ルールを作成）

---

### 補足
- ファイアウォールルールは複数作成可能です。
- IPアドレスはインターネット接続環境によって変わる場合があります。変更時は再設定が必要です。
- セキュリティのため、不要になったルールは削除しましょう。 